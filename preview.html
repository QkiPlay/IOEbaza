<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>File Preview</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/c.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { background: #222; color: #eee; font-family: 'Consolas', 'Courier New', monospace; }
    #preview { margin: 20px; }
    pre { background: #181818; padding: 16px; border-radius: 6px; }
  </style>
</head>
<body>
  <div id="preview"></div>
  <script>
    // Register highlight.js languages
    hljs.registerLanguage('python', window.hljs.getLanguage('python') || window.hljs.languages.python);
    hljs.registerLanguage('c', window.hljs.getLanguage('c') || window.hljs.languages.c);
    hljs.registerLanguage('cpp', window.hljs.getLanguage('cpp') || window.hljs.languages.cpp);

    function getQueryParam(param) {
      const params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

    const file = getQueryParam('file') || 'README.md';
    const ext = file.split('.').pop().toLowerCase();

    // Supported code extensions
    const codeExts = {
      'py': 'python',
      'c': 'c',
      'cpp': 'cpp',
      'h': 'c',
      'hpp': 'cpp'
    };

    function render(content) {
      const preview = document.getElementById('preview');
      if (ext === 'md' || ext === 'markdown') {
        preview.innerHTML = marked.parse(content);
      } else if (codeExts[ext]) {
        // Highlight code
        const lang = codeExts[ext];
        const codeBlock = document.createElement('pre');
        codeBlock.innerHTML = `<code class="language-${lang}">${hljs.highlight(content, {language: lang}).value}</code>`;
        preview.innerHTML = '';
        preview.appendChild(codeBlock);
      } else {
        // Plain text for other files
        preview.innerHTML = `<pre>${content}</pre>`;
      }
    }

    function fetchAndRender() {
      fetch(file)
        .then(res => {
          if (!res.ok) throw new Error('File not found');
          return res.text();
        })
        .then(render)
        .catch(err => {
          document.getElementById('preview').innerText = 'Error loading file: ' + err.message;
        });
    }

    window.addEventListener('DOMContentLoaded', fetchAndRender);
  </script>
</body>
</html>
