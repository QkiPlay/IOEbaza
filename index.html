<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baza IOE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="terminal">
        <div class="prompt">$ Baza wiedzy IOE</div>
        <div class="tree-output" id="file-tree"></div>
    </div>
    <script>
        /**
 * Dynamic file tree rendering for GitHub repo using GitHub API.
 * Preserves emotes/icons, download button, folder toggling, and viewer links.
 */
const repoOwner = "QkiPlay";
const repoName = "IOEbaza";
const branch = "main"; // Change if your default branch is different

function getFileIcon(name, type) {
    const ext = name.split('.').pop().toLowerCase();
    if (type === "dir") return "üìÅ";
    if (["md", "markdown"].includes(ext)) return "üìÑ";
    if (ext === "pdf") return "üìï";
    if (["py", "js", "css", "html"].includes(ext)) return "üíª";
    return "üìÑ";
}

function getViewerUrl(name, pathArr) {
    const filePath = pathArr.concat(name).join('/');
    const ext = name.split('.').pop().toLowerCase();
    if (["md", "markdown"].includes(ext)) {
        return `preview.html?file=${encodeURIComponent(filePath)}`;
    } else if (ext === "pdf") {
        return `pdfjs/web/viewer.html?file=${encodeURIComponent(filePath)}`;
    } else {
        return filePath;
    }
}

async function fetchGitHubDir(path = "") {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}?ref=${branch}`;
    const resp = await fetch(apiUrl);
    if (!resp.ok) return [];
    return await resp.json();
}

async function renderTree(container, pathArr = [], basePath = "") {
    const items = await fetchGitHubDir(basePath);
    items.sort((a, b) => a.type.localeCompare(b.type) || a.name.localeCompare(b.name));
    for (const item of items) {
        const line = document.createElement("div");
        line.style.whiteSpace = "nowrap";
        line.style.marginLeft = (pathArr.length * 16) + "px";
        if (item.type === "dir") {
            const folderId = "folder_" + Math.random().toString(36).slice(2);
            line.innerHTML = `
                <span class="folder-toggle" data-folderid="${folderId}" style="cursor:pointer;">
                    <span class="arrow" style="display:inline-block;width:16px;">‚ñ∂Ô∏è</span> 
                    <span>${getFileIcon(item.name, "dir")} <span style="color:#0ff;font-weight:bold;">${item.name}/</span></span>
                </span>
                <div id="${folderId}" class="collapsed" style="display:none;"></div>
            `;
            container.appendChild(line);

            line.querySelector('.folder-toggle').addEventListener('click', function() {
                const content = document.getElementById(folderId);
                const arrow = this.querySelector('.arrow');
                if (content.style.display === "none") {
                    content.style.display = "";
                    arrow.textContent = "üîΩ";
                    // Only load once (lazy load)
                    if (!content.hasChildNodes()) {
                        renderTree(content, pathArr.concat(item.name), item.path);
                    }
                } else {
                    content.style.display = "none";
                    arrow.textContent = "‚ñ∂Ô∏è";
                }
            });
        } else if (item.type === "file") {
            const viewerUrl = getViewerUrl(item.name, pathArr);
            const filePath = item.path;
            line.innerHTML = `
                ${getFileIcon(item.name, "file")}
                <a href="${viewerUrl}" class="file-link" target="_blank">${item.name}</a>
                <a href="https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${filePath}" download style="margin-left:8px;" title="Download">
                    <button style="padding:2px 6px;">‚¨áÔ∏è</button>
                </a>
            `;
            container.appendChild(line);
        }
    }
}

document.addEventListener("DOMContentLoaded", async () => {
    const treeContainer = document.getElementById("file-tree");
    treeContainer.innerHTML = '<span style="color: #00ffff; font-weight: bold;">IOEbaza/</span>';
    await renderTree(treeContainer);
});
    </script>
</body>
</html>